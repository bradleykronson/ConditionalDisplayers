{"version":3,"file":"index-vNU164VR.js","sources":["../../../Client/src/propertyeditors/dropdown/index.ts"],"sourcesContent":["import { customElement, html, property, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbChangeEvent } from \"@umbraco-cms/backoffice/event\";\nimport { cdDropdownFlexiblePropertyInfo } from \"../manifest\";\nimport { tagPrefix } from \"../../constants\";\nimport { UUISelectEvent } from \"@umbraco-cms/backoffice/external/uui\";\nimport { CdElement } from \"../../abstractions/CdElement\";\nimport { CdMultiValueModelDto } from \"../../components/cdMultivalues\";\n\nexport const elementName = `${tagPrefix}-dropdown`;\n\n@customElement(elementName)\nexport class CdDropDownFlexibleElement extends CdElement {\n    @property({ type: String, attribute: false })\n    public value?: string;\n\n    @property({ attribute: false })\n    public set config(config: UmbPropertyEditorConfigCollection) {\n        this.assignValuesFromConfig(config);\n    }\n\n    private availableValues: Array<CdMultiValueModelDto> = [];\n\n    @state()\n    private configDefaultValue?: string;\n\n    @state()\n    private configItems?: string;\n\n    @state()\n    private configParentPropertyAlias?: string;\n\n    @state()\n    private viewModelSelectOptions: Array<Option> = [];\n\n    #__selectedValue: string = \"\";\n    @state()\n    public get selectedValue() {\n        return this.#__selectedValue;\n    }\n    private set selectedValue(newValue: string) {\n        if (!newValue) {\n            throw new Error(\"value not set\");\n        }\n        this.#__selectedValue = newValue;\n        const selectedItem = this.availableValues.find(x => x.key === newValue);\n        if(selectedItem) {\n            this.selectedItem = selectedItem;\n        }\n        this.value = newValue;\n        this.dispatchEvent(new UmbChangeEvent());\n    }\n\n    private selectedItem?: CdMultiValueModelDto;\n\n    protected override bootstrap() {\n        this.runDisplayLogic();\n    }\n\n    protected override initDefaults() {\n        if (this.availableValues.length === 0) {\n            return;\n        }\n\n        if (this.value) {\n            this.selectedValue = this.value;\n        } else {\n            this.selectedValue = this.configDefaultValue && this.isValidSelection(this.configDefaultValue)\n                ? this.configDefaultValue\n                : (() => {\n                    console.warn(\"configuration is missing a valid default value\");\n                    return this.availableValues[0].key;\n                })();\n        }\n    }\n\n    protected override runDisplayLogic() {\n        this.viewModelSelectOptions = this.availableValues.map((item) => {\n            return <Option>{\n                name: item.value,\n                value: item.key,\n                selected: item.key === this.selectedValue\n            };\n        });\n\n        const selectedItem = this.getActiveItem();\n        if (selectedItem) {\n            this.displayProps(selectedItem.show, selectedItem.hide);\n        }\n    }\n\n    private assignValuesFromConfig(config: UmbPropertyEditorConfigCollection) {\n        this.configItems = config.getValueByAlias(cdDropdownFlexiblePropertyInfo.items.alias);\n        this.configDefaultValue = config.getValueByAlias(cdDropdownFlexiblePropertyInfo.default.alias);\n        this.configParentPropertyAlias = config.getValueByAlias(cdDropdownFlexiblePropertyInfo.parentPropertyAlias.alias);\n\n        // convert values\n        this.availableValues = this.configItems as unknown as Array<CdMultiValueModelDto>;\n    }\n\n\n    private getActiveItem(): CdMultiValueModelDto | undefined {\n        if (this.configParentPropertyAlias) {\n            const parentValue = this.getParentPropertyValue(this.configParentPropertyAlias);\n            if (parentValue !== undefined && parentValue !== null) {\n                const normalized = String(parentValue);\n                return this.availableValues.find(x => x.key === normalized || x.value === normalized);\n            }\n        }\n\n        return this.selectedItem;\n    }\n\n    private isValidSelection(value: string): boolean {\n        return !!this.availableValues.find(x => x.key === value);\n    }\n\n    #onChange(event: UUISelectEvent) {\n        event.stopPropagation();\n        const value = event.target.value as string;\n        this.selectedValue = value;\n        this.runDisplayLogic();\n    }\n\n    render() {\n        if (this.availableValues.length === 0) {\n            return html`<p>No conditional items configured</p>`;\n        }\n\n        return html`\n        <uui-select label=\"Display Selection\" @change=${this.#onChange} required .options=${this.viewModelSelectOptions} placeholder=\"Pick One\"></uui-select>\n        `;\n    }\n}\n\nexport default CdDropDownFlexibleElement;\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        [elementName]: CdDropDownFlexibleElement;\n    }\n}\n"],"names":["___selectedValue","_CdDropDownFlexibleElement_instances","onChange_fn","elementName","tagPrefix","CdDropDownFlexibleElement","CdElement","__privateAdd","config","__privateGet","newValue","__privateSet","selectedItem","x","UmbChangeEvent","item","cdDropdownFlexiblePropertyInfo","parentValue","normalized","value","html","__privateMethod","event","__decorateClass","property","state","customElement","CdDropDownFlexibleElement$1"],"mappings":"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"}