{"version":3,"file":"index-CfMimbsF.js","sources":["../../../Client/src/propertyeditors/value-displayer/index.ts"],"sourcesContent":["import { customElement, html, property, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbChangeEvent } from \"@umbraco-cms/backoffice/event\";\nimport { tagPrefix } from \"../../constants\";\nimport { CdElement } from \"../../abstractions/CdElement\";\nimport { CdMultiValueModelDto } from \"../../components/cdMultivalues\";\nimport { cdValueDisplayerPropertyInfo } from \"../manifest\";\n\nexport const elementName = `${tagPrefix}-value-displayer`;\n\n@customElement(elementName)\nexport class CdValueDisplayerElement extends CdElement {\n    private readonly onDocumentChange = () => this.runDisplayLogic();\n    private runToken = 0;\n\n    @property({ type: String, attribute: false })\n    public value?: string;\n\n    @property({ attribute: false })\n    public set config(config: UmbPropertyEditorConfigCollection) {\n        this.assignValuesFromConfig(config);\n    }\n\n    private availableValues: Array<CdMultiValueModelDto> = [];\n\n    @state()\n    private configSourcePropertyAlias?: string;\n\n    @state()\n    private configParentPropertyAlias?: string;\n\n    @state()\n    private resolvedSourceValueText = \"\";\n\n    protected override bootstrap() {\n        document.addEventListener(\"change\", this.onDocumentChange, true);\n        document.addEventListener(\"input\", this.onDocumentChange, true);\n        this.runDisplayLogic();\n    }\n\n    protected override initDefaults() {\n        // no-op, value is read from source properties\n    }\n\n    protected override runDisplayLogic() {\n        void this.runDisplayLogicAsync();\n    }\n\n    private async runDisplayLogicAsync() {\n        const token = ++this.runToken;\n        const sourceValue = await this.getSourceValue();\n\n        if (token !== this.runToken) {\n            return;\n        }\n\n        this.resolvedSourceValueText = sourceValue === undefined || sourceValue === null\n            ? \"(not found)\"\n            : String(sourceValue);\n\n        if (sourceValue === undefined || sourceValue === null) {\n            return;\n        }\n\n        const normalizedValue = String(sourceValue).trim();\n        this.value = normalizedValue;\n        this.dispatchEvent(new UmbChangeEvent());\n\n        const selectedItem = this.availableValues.find((x) => x.key === normalizedValue || x.value === normalizedValue);\n\n        if (selectedItem) {\n            this.displayProps(selectedItem.show, selectedItem.hide);\n        }\n    }\n\n    private async getSourceValue(): Promise<unknown> {\n        if (this.configParentPropertyAlias) {\n            const localParentValue = this.getParentPropertyValue(this.configParentPropertyAlias);\n            if (localParentValue !== undefined && localParentValue !== null) {\n                return localParentValue;\n            }\n\n            return await this.getParentNodePropertyValue(this.configParentPropertyAlias);\n        }\n\n        if (!this.configSourcePropertyAlias) {\n            return this.value;\n        }\n\n        return this.getCurrentPropertyValue(this.configSourcePropertyAlias);\n    }\n\n    private assignValuesFromConfig(config: UmbPropertyEditorConfigCollection) {\n        this.configSourcePropertyAlias = config.getValueByAlias(cdValueDisplayerPropertyInfo.sourcePropertyAlias.alias);\n        this.configParentPropertyAlias = config.getValueByAlias(cdValueDisplayerPropertyInfo.parentPropertyAlias.alias);\n\n        const items = config.getValueByAlias(cdValueDisplayerPropertyInfo.items.alias);\n        this.availableValues = (items as Array<CdMultiValueModelDto>) ?? [];\n    }\n\n    override disconnectedCallback(): void {\n        document.removeEventListener(\"change\", this.onDocumentChange, true);\n        document.removeEventListener(\"input\", this.onDocumentChange, true);\n        super.disconnectedCallback();\n    }\n\n    render() {\n        if (this.configParentPropertyAlias) {\n            return html`<small>Parent value (${this.configParentPropertyAlias}): ${this.resolvedSourceValueText}</small>`;\n        }\n\n        return html``;\n    }\n}\n\nexport default CdValueDisplayerElement;\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        [elementName]: CdValueDisplayerElement;\n    }\n}\n"],"names":["elementName","tagPrefix","CdValueDisplayerElement","CdElement","config","token","sourceValue","normalizedValue","UmbChangeEvent","selectedItem","x","localParentValue","cdValueDisplayerPropertyInfo","items","html","__decorateClass","property","state","customElement","CdValueDisplayerElement$1"],"mappings":";;;;;;;;;AAQa,MAAAA,IAAc,GAAGC,CAAS;AAG1B,IAAAC,IAAN,cAAsCC,EAAU;AAAA,EAAhD,cAAA;AAAA,UAAA,GAAA,SAAA,GACc,KAAA,mBAAmB,MAAM,KAAK,gBAAgB,GAC/D,KAAQ,WAAW,GAUnB,KAAQ,kBAA+C,CAAC,GASxD,KAAQ,0BAA0B;AAAA,EAAA;AAAA,EAblC,IAAW,OAAOC,GAA2C;AACzD,SAAK,uBAAuBA,CAAM;AAAA,EAAA;AAAA,EAcnB,YAAY;AAC3B,aAAS,iBAAiB,UAAU,KAAK,kBAAkB,EAAI,GAC/D,SAAS,iBAAiB,SAAS,KAAK,kBAAkB,EAAI,GAC9D,KAAK,gBAAgB;AAAA,EAAA;AAAA,EAGN,eAAe;AAAA,EAAA;AAAA,EAIf,kBAAkB;AACjC,IAAK,KAAK,qBAAqB;AAAA,EAAA;AAAA,EAGnC,MAAc,uBAAuB;AAC3B,UAAAC,IAAQ,EAAE,KAAK,UACfC,IAAc,MAAM,KAAK,eAAe;AAU1C,QARAD,MAAU,KAAK,aAInB,KAAK,0BAAuDC,KAAgB,OACtE,gBACA,OAAOA,CAAW,GAESA,KAAgB;AAC7C;AAGJ,UAAMC,IAAkB,OAAOD,CAAW,EAAE,KAAK;AACjD,SAAK,QAAQC,GACR,KAAA,cAAc,IAAIC,GAAgB;AAEjC,UAAAC,IAAe,KAAK,gBAAgB,KAAK,CAACC,MAAMA,EAAE,QAAQH,KAAmBG,EAAE,UAAUH,CAAe;AAE9G,IAAIE,KACA,KAAK,aAAaA,EAAa,MAAMA,EAAa,IAAI;AAAA,EAC1D;AAAA,EAGJ,MAAc,iBAAmC;AAC7C,QAAI,KAAK,2BAA2B;AAChC,YAAME,IAAmB,KAAK,uBAAuB,KAAK,yBAAyB;AAC/E,aAAkCA,KAI/B,MAAM,KAAK,2BAA2B,KAAK,yBAAyB;AAAA,IAAA;AAG3E,WAAC,KAAK,4BAIH,KAAK,wBAAwB,KAAK,yBAAyB,IAHvD,KAAK;AAAA,EAGkD;AAAA,EAG9D,uBAAuBP,GAA2C;AACtE,SAAK,4BAA4BA,EAAO,gBAAgBQ,EAA6B,oBAAoB,KAAK,GAC9G,KAAK,4BAA4BR,EAAO,gBAAgBQ,EAA6B,oBAAoB,KAAK;AAE9G,UAAMC,IAAQT,EAAO,gBAAgBQ,EAA6B,MAAM,KAAK;AACxE,SAAA,kBAAmBC,KAAyC,CAAC;AAAA,EAAA;AAAA,EAG7D,uBAA6B;AAClC,aAAS,oBAAoB,UAAU,KAAK,kBAAkB,EAAI,GAClE,SAAS,oBAAoB,SAAS,KAAK,kBAAkB,EAAI,GACjE,MAAM,qBAAqB;AAAA,EAAA;AAAA,EAG/B,SAAS;AACL,WAAI,KAAK,4BACEC,yBAA4B,KAAK,yBAAyB,MAAM,KAAK,uBAAuB,aAGhGA;AAAA,EAAA;AAEf;AAjGWC,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAJnCd,EAKF,WAAA,SAAA,CAAA;AAGIa,EAAA;AAAA,EADVC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAPrBd,EAQE,WAAA,UAAA,CAAA;AAOHa,EAAA;AAAA,EADPE,EAAM;AAAA,GAdEf,EAeD,WAAA,6BAAA,CAAA;AAGAa,EAAA;AAAA,EADPE,EAAM;AAAA,GAjBEf,EAkBD,WAAA,6BAAA,CAAA;AAGAa,EAAA;AAAA,EADPE,EAAM;AAAA,GApBEf,EAqBD,WAAA,2BAAA,CAAA;AArBCA,IAANa,EAAA;AAAA,EADNG,EAAclB,CAAW;AAAA,GACbE,CAAA;AAwGb,MAAAiB,IAAejB;"}