{"version":3,"file":"index-CVBUeDuj.js","sources":["../../../Client/src/propertyeditors/value-displayer/index.ts"],"sourcesContent":["import { customElement, html, property, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbChangeEvent } from \"@umbraco-cms/backoffice/event\";\nimport { tagPrefix } from \"../../constants\";\nimport { CdElement } from \"../../abstractions/CdElement\";\nimport { CdMultiValueModelDto } from \"../../components/cdMultivalues\";\nimport { cdValueDisplayerPropertyInfo } from \"../manifest\";\n\nexport const elementName = `${tagPrefix}-value-displayer`;\n\n@customElement(elementName)\nexport class CdValueDisplayerElement extends CdElement {\n    private readonly onDocumentChange = () => this.runDisplayLogic();\n    @property({ type: String, attribute: false })\n    public value?: string;\n\n    @property({ attribute: false })\n    public set config(config: UmbPropertyEditorConfigCollection) {\n        this.assignValuesFromConfig(config);\n    }\n\n    private availableValues: Array<CdMultiValueModelDto> = [];\n\n    @state()\n    private configSourcePropertyAlias?: string;\n\n    @state()\n    private configParentPropertyAlias?: string;\n\n    protected override bootstrap() {\n        document.addEventListener(\"change\", this.onDocumentChange, true);\n        document.addEventListener(\"input\", this.onDocumentChange, true);\n        this.runDisplayLogic();\n    }\n\n    protected override initDefaults() {\n        // no-op, value is read from source properties\n    }\n\n    protected override runDisplayLogic() {\n        const sourceValue = this.getSourceValue();\n\n        if (sourceValue === undefined || sourceValue === null) {\n            return;\n        }\n\n        const normalizedValue = String(sourceValue).trim();\n        this.value = normalizedValue;\n        this.dispatchEvent(new UmbChangeEvent());\n\n        const selectedItem = this.availableValues.find((x) => x.key === normalizedValue || x.value === normalizedValue);\n\n        if (selectedItem) {\n            this.displayProps(selectedItem.show, selectedItem.hide);\n        }\n    }\n\n    private getSourceValue(): unknown {\n        if (this.configParentPropertyAlias) {\n            return this.getParentPropertyValue(this.configParentPropertyAlias);\n        }\n\n        if (!this.configSourcePropertyAlias) {\n            return this.value;\n        }\n\n        return this.getCurrentPropertyValue(this.configSourcePropertyAlias);\n    }\n\n    private assignValuesFromConfig(config: UmbPropertyEditorConfigCollection) {\n        this.configSourcePropertyAlias = config.getValueByAlias(cdValueDisplayerPropertyInfo.sourcePropertyAlias.alias);\n        this.configParentPropertyAlias = config.getValueByAlias(cdValueDisplayerPropertyInfo.parentPropertyAlias.alias);\n\n        const items = config.getValueByAlias(cdValueDisplayerPropertyInfo.items.alias);\n        this.availableValues = (items as Array<CdMultiValueModelDto>) ?? [];\n    }\n\n    override disconnectedCallback(): void {\n        document.removeEventListener(\"change\", this.onDocumentChange, true);\n        document.removeEventListener(\"input\", this.onDocumentChange, true);\n        super.disconnectedCallback();\n    }\n\n    render() {\n        return html``;\n    }\n}\n\nexport default CdValueDisplayerElement;\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        [elementName]: CdValueDisplayerElement;\n    }\n}\n"],"names":["elementName","tagPrefix","CdValueDisplayerElement","CdElement","config","sourceValue","normalizedValue","UmbChangeEvent","selectedItem","x","cdValueDisplayerPropertyInfo","items","html","__decorateClass","property","state","customElement","CdValueDisplayerElement$1"],"mappings":";;;;;;;;;AAQa,MAAAA,IAAc,GAAGC,CAAS;AAG1B,IAAAC,IAAN,cAAsCC,EAAU;AAAA,EAAhD,cAAA;AAAA,UAAA,GAAA,SAAA,GACc,KAAA,mBAAmB,MAAM,KAAK,gBAAgB,GAS/D,KAAQ,kBAA+C,CAAC;AAAA,EAAA;AAAA,EAJxD,IAAW,OAAOC,GAA2C;AACzD,SAAK,uBAAuBA,CAAM;AAAA,EAAA;AAAA,EAWnB,YAAY;AAC3B,aAAS,iBAAiB,UAAU,KAAK,kBAAkB,EAAI,GAC/D,SAAS,iBAAiB,SAAS,KAAK,kBAAkB,EAAI,GAC9D,KAAK,gBAAgB;AAAA,EAAA;AAAA,EAGN,eAAe;AAAA,EAAA;AAAA,EAIf,kBAAkB;AAC3B,UAAAC,IAAc,KAAK,eAAe;AAEpC,QAA6BA,KAAgB;AAC7C;AAGJ,UAAMC,IAAkB,OAAOD,CAAW,EAAE,KAAK;AACjD,SAAK,QAAQC,GACR,KAAA,cAAc,IAAIC,GAAgB;AAEjC,UAAAC,IAAe,KAAK,gBAAgB,KAAK,CAACC,MAAMA,EAAE,QAAQH,KAAmBG,EAAE,UAAUH,CAAe;AAE9G,IAAIE,KACA,KAAK,aAAaA,EAAa,MAAMA,EAAa,IAAI;AAAA,EAC1D;AAAA,EAGI,iBAA0B;AAC9B,WAAI,KAAK,4BACE,KAAK,uBAAuB,KAAK,yBAAyB,IAGhE,KAAK,4BAIH,KAAK,wBAAwB,KAAK,yBAAyB,IAHvD,KAAK;AAAA,EAGkD;AAAA,EAG9D,uBAAuBJ,GAA2C;AACtE,SAAK,4BAA4BA,EAAO,gBAAgBM,EAA6B,oBAAoB,KAAK,GAC9G,KAAK,4BAA4BN,EAAO,gBAAgBM,EAA6B,oBAAoB,KAAK;AAE9G,UAAMC,IAAQP,EAAO,gBAAgBM,EAA6B,MAAM,KAAK;AACxE,SAAA,kBAAmBC,KAAyC,CAAC;AAAA,EAAA;AAAA,EAG7D,uBAA6B;AAClC,aAAS,oBAAoB,UAAU,KAAK,kBAAkB,EAAI,GAClE,SAAS,oBAAoB,SAAS,KAAK,kBAAkB,EAAI,GACjE,MAAM,qBAAqB;AAAA,EAAA;AAAA,EAG/B,SAAS;AACE,WAAAC;AAAA,EAAA;AAEf;AAxEWC,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAFnCZ,EAGF,WAAA,SAAA,CAAA;AAGIW,EAAA;AAAA,EADVC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GALrBZ,EAME,WAAA,UAAA,CAAA;AAOHW,EAAA;AAAA,EADPE,EAAM;AAAA,GAZEb,EAaD,WAAA,6BAAA,CAAA;AAGAW,EAAA;AAAA,EADPE,EAAM;AAAA,GAfEb,EAgBD,WAAA,6BAAA,CAAA;AAhBCA,IAANW,EAAA;AAAA,EADNG,EAAchB,CAAW;AAAA,GACbE,CAAA;AA6Eb,MAAAe,IAAef;"}