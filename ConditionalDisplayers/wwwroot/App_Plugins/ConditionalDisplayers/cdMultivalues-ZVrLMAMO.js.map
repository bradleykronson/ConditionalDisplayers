{"version":3,"file":"cdMultivalues-ZVrLMAMO.js","sources":["../../../Client/src/components/cdMultivalues.ts"],"sourcesContent":["import { customElement, html, nothing, property, repeat, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbPropertyEditorUiElement } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbChangeEvent } from \"@umbraco-cms/backoffice/event\";\nimport { tagPrefix } from \"../constants\";\nimport { UmbLitElement } from \"@umbraco-cms/backoffice/lit-element\";\n\nexport type CdMultiValueModelDto = {\n    value: string,\n    key: string,\n    show: string,\n    hide: string,\n}\nexport type CdMultiValueModel = CdMultiValueModelDto & {\n    sortOrder: number,\n    id: number\n}\n\nexport const elementName = `${tagPrefix}-multivalues`;\n\n@customElement(elementName)\nexport class CdMultivaluesElement extends UmbLitElement implements UmbPropertyEditorUiElement {\n    @property({ type: Array, attribute: false })\n    public value?: Array<CdMultiValueModelDto> | undefined;\n\n    private _items: Array<CdMultiValueModel> = [];\n\n    @state()\n    private get items(): Array<CdMultiValueModel> {\n        return this._items;\n    }\n    \n    private set items(value: Array<CdMultiValueModel>) {\n        this._items = value;\n\n        const dtoItems: Array<CdMultiValueModelDto> = this._items.map(x => ({ value: x.value, key: x.key, show: x.show, hide: x.hide }));\n        this.value = dtoItems;\n        this.dispatchEvent(new UmbChangeEvent());\n    }\n\n    @state()\n    private liveItem!: CdMultiValueModelDto;\n\n    override connectedCallback(): void {\n        super.connectedCallback();\n        setTimeout(() => {\n            this.initValue();\n        }, 0);\n    }\n\n    private initValue() {\n        let items: Array<CdMultiValueModel> = [];\n        if (this.value) {\n            for (let i = 0; i < this.value.length; i++) {\n                const dtoItem = this.value[i] as unknown as CdMultiValueModelDto;\n                const item: CdMultiValueModel = { id: i, sortOrder: i, ...dtoItem };\n                items.push(item);\n            }\n            this.augmentItemValues(items);\n\n            // sort items by stored value\n            items = items.sort((a, b) => a.sortOrder > b.sortOrder ? 1 : ((b.sortOrder > a.sortOrder) ? -1 : 0));\n\n            // update editor value\n            this.items = items;\n        }\n\n        this.liveItem = this.getEmptyItem();\n    }\n\n    private augmentItemValues(items?: Array<CdMultiValueModel>) {\n        items = items || this.items;\n        for (let i = 0; i < items.length; i++) {\n            items[i].id = i;\n            items[i].sortOrder = i;\n        }\n\n        return items;\n    }\n\n    #onItemInput(event: InputEvent) {\n        const rowEl = (event.target as HTMLElement).closest('[data-id]') as HTMLElement;\n        const itemId = parseInt(rowEl.dataset.id!);\n        const itemValue = this.getItemValueFromRow(rowEl);\n        const index = this.items.findIndex(x => x.id === itemId);\n        this.items[index] = { ...this.items[index], ...itemValue };\n        this.items = this.items;    // trigger set action\n    }\n    #onLiveItemInput(event: InputEvent) {\n        const rowEl = (event.target as HTMLElement).closest('#liveItemRow') as HTMLElement;\n        const itemValue = this.getItemValueFromRow(rowEl);\n        this.liveItem = { value: itemValue.value, key: itemValue.key, show: itemValue.show, hide: itemValue.hide };\n    }\n    #onAdd() {\n        // TODO: validate\n        this.items.push({ id: 0, sortOrder: 0, ...this.liveItem });\n        this.augmentItemValues();\n        this.items = this.items;    // trigger set action\n        this.liveItem = this.getEmptyItem();\n    }\n    #onRemove(event: Event) {\n        const rowEl = (event.target as HTMLElement).closest('[data-id]') as HTMLElement;\n        const itemValue = this.getItemValueFromRow(rowEl);\n        const index = this.items.findIndex(x => x.id === itemValue.id);\n        this.items.splice(index, 1);\n        this.items = this.items;    // trigger set action\n    }\n\n    private getEmptyItem(): CdMultiValueModelDto {\n        return {\n            value: \"\",\n            key: \"\",\n            show: \"\",\n            hide: \"\"\n        };\n    }\n    private getItemValueFromRow(el: HTMLElement): CdMultiValueModel {\n        const val: Partial<CdMultiValueModel> = {};\n        const inputEls = el.querySelectorAll('uui-input');\n        inputEls.forEach(inputEl => {\n            const name = inputEl.name;\n            // @ts-ignore\n            val[name] = inputEl.value;\n        });\n\n        // parseInt is 'null' if passed 'undefined'\n        val.id = parseInt(el.dataset.id!);\n        val.sortOrder = parseInt(el.dataset.sort!);\n\n        return val as Required<CdMultiValueModel>;\n    }\n\n    render() {\n        if (!this.liveItem) {\n            return nothing;\n        }\n\n        return html`\n        <uui-box style=\"--uui-box-default-padding: 0;\">\n            <uui-table>                \n                <uui-table-column></uui-table-column>\n                <uui-table-column></uui-table-column>\n                <uui-table-column></uui-table-column>\n                <uui-table-column></uui-table-column>\n                <uui-table-column style=\"width: 10%;\"></uui-table-column>\n\n                <uui-table-head>\n                    <uui-table-head-cell>Text</uui-table-head-cell>\n                    <uui-table-head-cell>Key</uui-table-head-cell>\n                    <uui-table-head-cell>Show when selected</uui-table-head-cell>\n                    <uui-table-head-cell>Hide when selected</uui-table-head-cell>\n                    <uui-table-head-cell></uui-table-head-cell>\n                </uui-table-head>\n                <uui-table-row id=\"liveItemRow\" @input=${this.#onLiveItemInput}>\n                    <uui-table-cell>\n                        <uui-input name=\"value\" type=\"text\" style=\"width: 100%;\" .value=${this.liveItem.value}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-input name=\"key\" type=\"text\" style=\"width: 100%;\" .value=${this.liveItem.key}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-input name=\"show\" type=\"text\"  style=\"width: 100%;\" placeholder=\"Targets (alias / tab-... / tab-content-... / group-...)\" .value=${this.liveItem.show}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-input name=\"hide\" type=\"text\"  style=\"width: 100%;\" placeholder=\"Targets (alias / tab-... / tab-content-... / group-...)\" .value=${this.liveItem.hide}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-button label=\"Add\" @click=${this.#onAdd} compact=\"compact\" look=\"secondary\" title=\"Add new item\"><uui-icon name=\"icon-badge-add\"></uui-icon> Add</uui-button>\n                    </uui-table-cell>\n                </uui-table-row>\n                ${repeat(this.items, x => x.id, x => html`\n                <uui-table-row data-id=${x.id} data-sort=${x.sortOrder} @input=${this.#onItemInput} style=\"background: #f3f3f5;\">\n                    <uui-table-cell>\n                        <uui-input name=\"value\" type=\"text\" style=\"width: 100%;\" .value=${x.value} ></uui-input>\n                    </uui-table-cell>\n                      <uui-table-cell>\n                        <uui-input name=\"key\" type=\"text\" style=\"width: 100%;\" .value=${x.key} ></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-input name=\"show\" type=\"text\" style=\"width: 100%;\" placeholder=\"Targets (alias / tab-... / tab-content-... / group-...)\" .value=${x.show}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-input name=\"hide\" type=\"text\" style=\"width: 100%;\" placeholder=\"Targets (alias / tab-... / tab-content-... / group-...)\" .value=${x.hide}></uui-input>\n                    </uui-table-cell>\n                    <uui-table-cell>\n                        <uui-button label=\"Remove\" @click=${this.#onRemove} compact=\"compact\" look=\"secondary\" color=\"danger\" title=\"Remove item\"><uui-icon name=\"icon-trash\"></uui-icon> Remove</uui-button>\n                    </uui-table-cell>\n                </uui-table-row>\n                `)}\n            </uui-table>\n        </uui-box>\n        `;\n    }\n}\n\nexport default CdMultivaluesElement;\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        [elementName]: CdMultivaluesElement;\n    }\n}\n"],"names":["_CdMultivaluesElement_instances","onItemInput_fn","onLiveItemInput_fn","onAdd_fn","onRemove_fn","elementName","tagPrefix","CdMultivaluesElement","UmbLitElement","__privateAdd","value","dtoItems","x","UmbChangeEvent","items","i","dtoItem","item","a","b","el","val","inputEl","name","html","__privateMethod","repeat","nothing","event","rowEl","itemId","itemValue","index","__decorateClass","property","state","customElement","CdMultivaluesElement$1"],"mappings":"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"}