{"version":3,"file":"index-FZ6LQrXp.js","sources":["../../../Client/src/propertyeditors/radio/index.ts"],"sourcesContent":["import { customElement, html, property, repeat, state } from \"@umbraco-cms/backoffice/external/lit\";\nimport { UmbPropertyEditorConfigCollection } from \"@umbraco-cms/backoffice/property-editor\";\nimport { UmbChangeEvent } from \"@umbraco-cms/backoffice/event\";\nimport { cdRadioPropertyInfo } from \"../manifest\";\nimport { tagPrefix } from \"../../constants\";\nimport { UUIBooleanInputEvent } from \"@umbraco-cms/backoffice/external/uui\";\nimport { CdElement } from \"../../abstractions/CdElement\";\nimport { CdMultiValueModelDto } from \"../../components/cdMultivalues\";\n\ntype LabelPositions = \"Top\" | \"Bottom\" | \"Left\" | \"Right\";\ntype SelectionType = \"Radio\" | \"Checkbox\";\n\nexport const elementName = `${tagPrefix}-radio`;\n\n@customElement(elementName)\nexport class CdRadioElement extends CdElement {\n    @property({ type: String, attribute: false })\n    public value?: string;\n\n    @property({ attribute: false })\n    public set config(config: UmbPropertyEditorConfigCollection) {\n        this.assignValuesFromConfig(config);\n    }\n\n    private availableValues: Array<CdMultiValueModelDto> = [];\n\n    @state()\n    private configDefaultValue?: string;\n\n    @state()\n    private configItems?: string;\n\n    @state()\n    private configParentPropertyAlias?: string;\n\n    @state()\n    private configSelectionType: SelectionType = \"Radio\";\n\n    @state()\n    private configAlignHorizontal?: boolean;\n\n    @state()\n    private configLabelPosition?: LabelPositions;\n\n    @state()\n    private configAsButton?: boolean;\n\n    private selectedItem?: CdMultiValueModelDto;\n\n    #__selectedValue: string = \"\";\n    @state()\n    public get selectedValue() {\n        return this.#__selectedValue;\n    }\n    private set selectedValue(newValue: string) {\n        if (!newValue) {\n            throw new Error(\"value not set\");\n        }\n        this.#__selectedValue = newValue;\n        this.selectedItem = this.availableValues.find(x => x.value === newValue || x.key === newValue);\n        this.value = newValue;\n        this.dispatchEvent(new UmbChangeEvent());\n    }\n\n    #__selectedValues: Array<string> = [];\n    @state()\n    public get selectedValues() {\n        return this.#__selectedValues;\n    }\n    private set selectedValues(values: Array<string>) {\n        this.#__selectedValues = values;\n        this.value = values.join(\",\");\n        this.dispatchEvent(new UmbChangeEvent());\n    }\n\n    protected override bootstrap() {\n        this.runDisplayLogic();\n    }\n\n    protected override initDefaults() {\n        if (this.configSelectionType === \"Checkbox\") {\n            if (this.value && this.value.trim().length > 0) {\n                this.selectedValues = this.parseMultiValue(this.value);\n            } else if (this.configDefaultValue && this.configDefaultValue.trim().length > 0) {\n                this.selectedValues = this.parseMultiValue(this.configDefaultValue);\n            }\n            return;\n        }\n\n        if (this.value) {\n            this.selectedValue = this.value;\n        } else {\n            this.selectedValue = this.configDefaultValue && this.isValidSelection(this.configDefaultValue)\n                ? this.configDefaultValue\n                : (() => {\n                    console.warn(\"configuration is missing a valid default value\");\n                    return this.availableValues[0].value;\n                })();\n        }\n    }\n\n    protected override runDisplayLogic() {\n        if (this.configSelectionType === \"Checkbox\") {\n            this.runCheckboxGroupDisplayLogic();\n            return;\n        }\n     \n        const selectedItem = this.getActiveItem();\n\n        if (selectedItem) {\n            this.displayProps(selectedItem.show, selectedItem.hide);\n        }\n    }\n\n\n    private getActiveItem(): CdMultiValueModelDto | undefined {\n        if (this.configParentPropertyAlias) {\n            const parentValue = this.getParentPropertyValue(this.configParentPropertyAlias);\n            if (parentValue !== undefined && parentValue !== null) {\n                const normalized = String(parentValue);\n                return this.availableValues.find(x => x.value === normalized || x.key === normalized);\n            }\n        }\n\n        return this.selectedItem;\n    }\n\n    private assignValuesFromConfig(config: UmbPropertyEditorConfigCollection) {\n        this.configItems = config.getValueByAlias(cdRadioPropertyInfo.items.alias);\n        this.configDefaultValue = config.getValueByAlias(cdRadioPropertyInfo.default.alias);\n        this.configParentPropertyAlias = config.getValueByAlias(cdRadioPropertyInfo.parentPropertyAlias.alias);\n        this.configSelectionType = config.getValueByAlias(cdRadioPropertyInfo.selectionType.alias) ?? \"Radio\";\n        this.configAlignHorizontal = config.getValueByAlias(cdRadioPropertyInfo.alignHrz.alias);\n        this.configLabelPosition = config.getValueByAlias(cdRadioPropertyInfo.labelsPos.alias);\n        this.configAsButton = config.getValueByAlias(cdRadioPropertyInfo.asBtn.alias);\n\n        this.availableValues = this.configItems as unknown as Array<CdMultiValueModelDto>;\n    }\n\n    private isValidSelection(value: string): boolean {\n        return !!this.availableValues.find(x => x.value === value || x.key === value);\n    }\n\n\n    private parseMultiValue(value: string): Array<string> {\n        return value\n            .split(',')\n            .map(x => x.trim())\n            .filter(x => !!x);\n    }\n\n    private runCheckboxGroupDisplayLogic() {\n        const selectedValues = this.configParentPropertyAlias\n            ? this.parseMultiValue(String(this.getParentPropertyValue(this.configParentPropertyAlias) ?? \"\"))\n            : this.selectedValues;\n\n        const selectedItems = this.availableValues.filter(x => selectedValues.includes(x.value) || selectedValues.includes(x.key));\n\n        if (!selectedItems.length) {\n            return;\n        }\n\n        const showAliases = selectedItems.map(x => x.show).filter(x => !!x).join(',');\n        const hideAliases = selectedItems.map(x => x.hide).filter(x => !!x).join(',');\n        this.displayProps(showAliases, hideAliases);\n    }\n\n    #onChange(event: UUIBooleanInputEvent) {\n        event.stopPropagation();\n        const value = event.target.value;\n\n        if (this.configSelectionType === \"Checkbox\") {\n            const target = event.target as unknown as HTMLInputElement;\n            const current = [...this.selectedValues];\n\n            if (target.checked) {\n                if (!current.includes(value)) {\n                    current.push(value);\n                }\n            } else {\n                this.selectedValues = current.filter(x => x !== value);\n                this.runDisplayLogic();\n                return;\n            }\n\n            this.selectedValues = current;\n            this.runDisplayLogic();\n            return;\n        }\n\n        this.selectedValue = value;\n        this.runDisplayLogic();\n    }\n\n    render() {\n        if (this.availableValues.length === 0) {\n            return html`<p>No conditional items configured</p>`;\n        }\n\n        if (this.configSelectionType === \"Checkbox\") {\n            return this.renderCheckboxGroup();\n        }\n\n        return html`\n        ${this.configAsButton ? this.renderButtonGroup() : this.renderRadioGroup()}\n        `;\n    }\n\n    private renderRadioGroup() {\n        return html`\n        <div class=\"cd-conditional-group ${this.configAlignHorizontal ? \"horizontal\" : \"\"} labelpos-${this.configLabelPosition}\" @change=${this.#onChange}>\n            ${repeat(this.availableValues, x => html`\n                <label><input type=\"radio\" name=\"radioGroup\" value=\"${x.value}\" .checked=${this.selectedValue === x.value || this.selectedValue === x.key} /><span class=\"label\">${x.value}</span></label>\n            `)}\n        </div>\n        `;\n    }\n\n    private renderCheckboxGroup() {\n        return html`\n        <div class=\"cd-conditional-group ${this.configAlignHorizontal ? \"horizontal\" : \"\"} labelpos-${this.configLabelPosition}\" @change=${this.#onChange}>\n            ${repeat(this.availableValues, x => html`\n                <label><input type=\"checkbox\" value=\"${x.value}\" .checked=${this.selectedValues.includes(x.value) || this.selectedValues.includes(x.key)} /><span class=\"label\">${x.value}</span></label>\n            `)}\n        </div>\n        `;\n    }\n\n    private renderButtonGroup() {\n        return html`\n        <div class=\"cd-conditional-group ${this.configAlignHorizontal ? \"horizontal\" : \"\"}\" @click=${this.#onChange}>\n            ${repeat(this.availableValues, x => html`\n            <uui-button label=\"${x.value}\" value=\"${x.value}\" look=\"${this.selectedValue === x.value ? 'primary' : 'secondary'}\"></uui-button>\n            `)}\n        </div>\n        `;\n    }\n}\n\nexport default CdRadioElement;\n\ndeclare global {\n    interface HTMLElementTagNameMap {\n        [elementName]: CdRadioElement;\n    }\n}\n"],"names":["___selectedValue","___selectedValues","_CdRadioElement_instances","onChange_fn","elementName","tagPrefix","CdRadioElement","CdElement","__privateAdd","config","__privateGet","newValue","__privateSet","x","UmbChangeEvent","values","selectedItem","parentValue","normalized","cdRadioPropertyInfo","value","selectedValues","selectedItems","showAliases","hideAliases","html","__privateMethod","repeat","event","target","current","__decorateClass","property","state","customElement","CdRadioElement$1"],"mappings":"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"}